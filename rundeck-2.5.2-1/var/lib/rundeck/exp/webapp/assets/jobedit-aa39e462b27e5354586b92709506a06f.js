function showError(a){appendHtml($("editerror"),a);$("editerror").show()}function showRowSelected(a,b,c){c=document.getElementsByClassName(c,b);for(b=0;b<c.length;b++)$(c[b]).removeClassName("selected");a&&$(a)&&$(a).addClassName("selected")}function _editFormSelectProject(a){}function prepJobType(a){a.authorized?$("scriptAuthWarn").hide():$("scriptAuthWarn").show()}var jobEdittedHandler;function _onJobEdit(a){jobEdittedHandler=a}
function jobWasEdited(){"function"==typeof jobEdittedHandler&&jobEdittedHandler()}
function _wfiedit(a,b,c){jobWasEdited();b={num:b,isErrorHandler:c?!0:!1,key:a};getCurSEID()&&(b.scheduledExecutionId=getCurSEID());jQuery("#wfli_"+a).load(_genUrl(appLinks.workflowEdit,b),function(b,c,e){_hideWFItemControls();b=jQuery("#wfli_"+a);b.find("input").each(function(a,b){"text"===b.type&&b.observe("keypress",noenter)});b.find("textarea.apply_ace").each(function(a,b){_addAceTextarea(b)});initTooltipForElements("#wfli_"+a+" .obs_tooltip")})}
function _wfiview(a,b,c){b={num:b,edit:!0,key:a,isErrorHandler:c?!0:!1};getCurSEID()&&(b.scheduledExecutionId=getCurSEID());jQuery("#wfli_"+a).load(_genUrl(appLinks.workflowRender,b),_showWFItemControls)}
function _wfisave(a,b,c,d){jobWasEdited();c=jQuery("#"+c+" :input").serialize();jQuery.ajax({type:"POST",url:_genUrl(appLinks.workflowSave),data:c,beforeSend:_ajaxSendTokens.curry("job_edit_tokens"),success:function(c,e,g){e=jQuery("#wfli_"+a);e.html(c);1>e.find("div.wfitemEditForm").size()&&(_showWFItemControls(),d&&_hideWFItemControlsAddEH(b));initTooltipForElements("#wfli_"+a+" .obs_tooltip")}}).success(_ajaxReceiveTokens.curry("job_edit_tokens"))}var newitemElem;
function _wfiaddnew(a,b){jobWasEdited();var c={newitemtype:a,newitemnodestep:b?!0:!1};getCurSEID()&&(c.scheduledExecutionId=getCurSEID());clearHtml("wfnewitem");$("wfnewtypes").hide();_hideWFItemControls();var d=$("workflowContent").down("ol"),f=$$("#workflowContent ol > li").length;c.key=f;var e=new Element("li");1==f%2&&e.addClassName("alternate");e.setAttribute("data-wfitemnum",f);newitemElem=new Element("span");newitemElem.setAttribute("id","wfli_"+f);e.appendChild(newitemElem);var g=new Element("div");
g.setAttribute("id","wfivis_"+f);e.appendChild(g);g=new Element("ul");g.addClassName("wfhandleritem");g.style.display="none";g.setAttribute("data-wfitemnum",f);var h=new Element("li");h.setAttribute("id","wfli_eh_"+f);g.appendChild(h);e.appendChild(g);d.appendChild(e);jQuery(newitemElem).load(_genUrl(appLinks.workflowEdit,c),function(){$(newitemElem).select("input").each(function(a){"text"==a.type&&a.observe("keypress",noenter)});$(newitemElem).down("input[type=text]").focus();initTooltipForElements("#wfli_"+
f+" .obs_tooltip");$(newitemElem).select("textarea.apply_ace").each(_addAceTextarea)})}function _addAceTextarea(a){_setupAceTextareaEditor(a,function(){jobWasEdited()})}
function _wfisavenew(a){jobWasEdited();a=jQuery("#"+a+" :input").serialize();jQuery.ajax({type:"POST",url:_genUrl(appLinks.workflowSave),data:a,beforeSend:_ajaxSendTokens.curry("job_edit_tokens"),success:function(a,c,d){jQuery(newitemElem).html(a);a=$(newitemElem.parentNode);$(a).highlight();$("wfnewbutton").show();_showWFItemControls();$("workflowDropfinal").setAttribute("data-wfitemnum",parseInt(a.getAttribute("data-wfitemnum"))+1);newitemElem=null}}).success(_ajaxReceiveTokens.curry("job_edit_tokens"))}
function _wficancelnew(){var a=$("workflowContent").down("ol");$(a).removeChild($(newitemElem.parentNode));newitemElem=null;$("wfnewbutton").show();_showWFItemControls()}function _findParentAttr(a,b){for(var c=a.getAttribute(b);a&&!c&&!a.hasAttribute(b);)c=a.parentNode.getAttribute(b),a=a.parentNode;return c}function _evtNewStepChooseType(a){a=a.element();a=_findParentAttr(a,"data-step-type");_wfiaddnew(a,!1)}
function _evtNewNodeStepChooseType(a){a=a.element();a=_findParentAttr(a,"data-node-step-type");_wfiaddnew(a,!0)}function _evtNewStepCancel(a){$("wfnewtypes").hide();$("wfnewbutton").show()}function _hideWFItemControls(){$$("#workflowContent span.wfitemcontrols").each(Element.hide);$("wfundoredo").hide();$("wfnewbutton").hide()}function _updateEmptyMessage(){$("workflowContent").down("ol li")?$("wfempty").hide():$("wfempty").show()}
function _showWFItemControls(){$$("#workflowContent span.wfitemcontrols").each(Element.show);$("wfundoredo").show();$("wfnewbutton").show();_updateWFUndoRedo();_enableDragdrop();_updateEmptyMessage()}function _hideWFItemControlsAddEH(a){$("wfli_"+a).select(".wfitem_add_errorhandler").each(Element.hide)}function _evtNewEHChooseType(a){a=a.element();var b=_findParentAttr(a,"data-step-type");_wfiaddNewErrorHandler(a,b,null,!1)}
function _evtNewEHNodeStepType(a){a=a.element();var b=_findParentAttr(a,"data-node-step-type");_wfiaddNewErrorHandler(a,b,null,!0)}function _hideAddNewEHLinks(){$$("span.wfitem_add_errorhandler").each(Element.hide)}function _showAddNewEHLinks(){$$("span.wfitem_add_errorhandler").each(Element.show)}function _evtNewEHCancel(a){$(a.element()).up("ul.wfhandleritem",0).hide();_hideAddNewEH();_showWFItemControls()}
function _wficancelnewEH(a){$(a).up("ul.wfhandleritem",0).hide();a=$(a).up("ul.wfhandleritem li",0);clearHtml(a);_showWFItemControls()}function _hideAddNewEH(){var a=$("wfnewtypes"),b=$("wfnew_eh_types");b.hide();b.parentNode.removeChild(b);$(a).insert({after:b})}
function _wfishownewErrorHandler(a,b,c){b=$("wfnew_eh_types");a=$("wfli_eh_"+a);clearHtml(a);b.parentNode.removeChild(b);a.appendChild(b);var d=$("wf_strat_node_first").checked;c=!(c&&d);$(b).select(".step_section").each(c?Element.show:Element.hide);b.show();$(a.parentNode).show();_hideWFItemControls()}
function _wfiaddNewErrorHandler(a,b,c,d){null==c&&(a=$(a).up("ul.wfhandleritem",0))&&(c=a.getAttribute("data-wfitemnum"));var f="eh_"+c;b={newitemtype:b,key:f,num:c,isErrorHandler:!0,newitemnodestep:d?!0:!1};getCurSEID()&&(b.scheduledExecutionId=getCurSEID());var e=jQuery("#wfli_"+f);_hideAddNewEH();e.load(_genUrl(appLinks.workflowEdit,b),function(){e.find("input").each(function(a,b){"text"==b.type&&b.observe("keypress",noenter)});e.find("textarea.apply_ace").each(function(){_addAceTextarea(this)});
initTooltipForElements("#wfli_"+f+" .obs_tooltip")})}function _doMoveItem(a,b){_ajaxWFAction(appLinks.workflowReorder,{fromnum:a,tonum:b,edit:!0})}function _doRemoveItem(a,b,c){var d={delnum:b,edit:!0,key:a,isErrorHandler:c};Effect.Fade($("wfivis_"+a),{duration:.2,afterFinish:function(a){_ajaxWFAction(appLinks.workflowRemove,d)}})}function _doUndoWFAction(){_ajaxWFAction(appLinks.workflowUndo,{edit:!0})}function _doRedoWFAction(){_ajaxWFAction(appLinks.workflowRedo,{edit:!0})}
function _doResetWFAction(){_ajaxWFAction(appLinks.workflowRevert,{edit:!0})}function _ajaxWFAction(a,b){jobWasEdited();getCurSEID()&&(b.scheduledExecutionId=getCurSEID());jQuery.ajax({type:"POST",url:_genUrl(a),data:b,beforeSend:_ajaxSendTokens.curry("reqtoken_undo_workflow"),success:function(a,b,f){jQuery("#workflowContent").find("ol").html(a);newitemElem=null;$("wfnewbutton").show();_showWFItemControls()}})}
function _updateWFUndoRedo(){var a={};getCurSEID()&&(a.scheduledExecutionId=getCurSEID());jQuery("#wfundoredo").load(_genUrl(appLinks.workflowRenderUndo,a))}function moveDragItem(a,b){var c=$(a).getAttribute("data-wfitemnum"),d=$(b).getAttribute("data-wfitemnum");d>c&&--d;_doMoveItem(c,d)}
function _enableDragdrop(){$$("#workflowContent ol>li").each(function(a){new Draggable(a,{revert:"failure",ghosting:!1,constraint:"vertical",handle:"dragHandle",scroll:window,onStart:function(a){$("workflowDropfinal").show()},onEnd:function(a){$("workflowDropfinal").hide()}})});$$("#workflowContent ol>li").each(function(a){Droppables.add(a,{hoverclass:"hoverActive",onDrop:moveDragItem});$(a).addClassName("ready")});$$("#workflowDropfinal").each(function(a){Droppables.add(a,{hoverclass:"hoverActive",
onDrop:moveDragItem});$(a).addClassName("ready")})}function _doRevertAction(a){return"workflow"==a?_doResetWFAction():"opts"==a?_doRevertOptsAction():null}function _doRedoAction(a){return"workflow"==a?_doRedoWFAction():"opts"==a?_doRedoOptsAction():null}function _doUndoAction(a){return"workflow"==a?_doUndoWFAction():"opts"==a?_doUndoOptsAction():null}var newoptli;
function _showOptControls(){$$("#optionsContent .opteditcontrols").each(Element.show);$("optnewbutton").show();_updateOptsUndoRedo();_showOptEmptyMessage();clearHtml("optsload")}function _showOptEmptyMessage(){$("optionsContent").down("ul li")?($("optempty").hide(),$("optheader").show()):($("optempty").show(),$("optheader").hide())}function _hideOptControls(){$$("#optionsContent .opteditcontrols").each(Element.hide);$("optnewbutton").hide();clearHtml("optsload")}
function _updateOptsUndoRedo(){var a={};getCurSEID()&&(a.scheduledExecutionId=getCurSEID());jQuery("#optundoredo").load(_genUrl(appLinks.editOptsRenderUndo,a))}function _configureInputRestrictions(a){$(a).select("input").each(function(a){"text"==a.type&&a.observe("keypress",noenter)});$(a).select("input.restrictOptName").each(function(a){"text"==a.type&&a.observe("keypress",function(a){return controlkeycode(a)||onlychars("[a-zA-Z_0-9.\\t-]",a)})})}
function _isjobScheduled(){return"true"==jQuery("#scheduledTrue:checked").val()}function _optedit(a,b){jobWasEdited();var c={name:a};getCurSEID()&&(c.scheduledExecutionId=getCurSEID());c.jobWasScheduled=_isjobScheduled();$("optsload").loading();jQuery.ajax({type:"GET",url:_genUrl(appLinks.editOptsEdit,c),success:function(a,c,e){jQuery(b).html(a);_hideOptControls();_configureInputRestrictions(b)},failure:function(a,b,c){alert("error: "+b)}})}
function _optview(a,b){var c={name:a,edit:!0};getCurSEID()&&(c.scheduledExecutionId=getCurSEID());c.jobWasScheduled=_isjobScheduled();jQuery(b).load(_genUrl(appLinks.editOptsRender,c),_showOptControls)}
function _optsave(a,b,c){jobWasEdited();$("optsload").loading();jQuery.ajax({type:"POST",url:_genUrl(appLinks.editOptsSave,{jobWasScheduled:_isjobScheduled()}),data:jQuery("#"+a+" :input").serialize(),beforeSend:_ajaxSendTokens.curry(b),success:function(a,b,e){jQuery(c).html(a);$(c).down("div.optEditForm")?(_configureInputRestrictions(c),_hideOptControls()):(_showOptControls(),$(c).highlight())}})}function _optaddnewIfNone(){var a=$$("#optionsContent ul li");a&&0!=a.length||_optaddnew()}
function _optaddnew(){jobWasEdited();var a={newoption:!0};getCurSEID()&&(a.scheduledExecutionId=getCurSEID());_hideOptControls();var b=$("optionsContent").down("ul"),c=$$("#optionsContent ul li").length;newoptli=new Element("li");1==c%2&&newoptli.addClassName("alternate");newoptli.addClassName("optEntry");var d=new Element("div");d.setAttribute("id","optvis_"+c);newoptli.appendChild(d);b.appendChild(newoptli);$("optsload").loading();jQuery(d).load(_genUrl(appLinks.editOptsEdit,a),null,function(a,
b,c){"success"==b&&(_configureInputRestrictions(d),_hideOptControls());clearHtml("optsload")})}function _optcancelnew(){var a=$("optionsContent").down("ul");$(a).removeChild(newoptli);newoptli=null;_showOptControls()}
function _reloadOpts(){var a={newoption:!0,edit:!0};getCurSEID()&&(a.scheduledExecutionId=getCurSEID());$("optionsContent").down("ul.options");$("optsload").loading();jQuery("#optionsContent").find("ul.options").load(_genUrl(appLinks.editOptsRenderAll,a),function(a,c,d){_showOptControls()})}
function _summarizeOpts(){var a={newoption:!0,edit:!0};getCurSEID()&&(a.scheduledExecutionId=getCurSEID());$("optssummary");$("optsload").loading();jQuery("#optssummary").load(_genUrl(appLinks.editOptsRenderSummary,a),_showOptControls)}
function _optsavenew(a,b){jobWasEdited();var c=jQuery("#"+a+" :input").serialize();$("optsload").loading();jQuery.ajax({type:"POST",url:_genUrl(appLinks.editOptsSave,{jobWasScheduled:_isjobScheduled()}),data:c,beforeSend:_ajaxSendTokens.curry(b),success:function(a,b,c){jQuery(newoptli).html(a);newoptli.down("div.optEditForm")?newoptli.down("div.optEditForm")&&(_configureInputRestrictions(newoptli),_hideOptControls()):($(newoptli).highlight(),newoptli=null,_showOptControls(),_reloadOpts())}})}
function _doRemoveOption(a,b,c){jobWasEdited();var d={name:a,edit:!0};getCurSEID()&&(d.scheduledExecutionId=getCurSEID());$("optsload").loading();Effect.Fade($(b),{duration:.2,afterFinish:function(a){jQuery.ajax({type:"POST",url:_genUrl(appLinks.editOptsRemove),data:d,beforeSend:_ajaxSendTokens.curry(c),success:function(a,b,c){jQuery("#optionsContent").find("ul").html(a);_showOptControls()}})}})}
function _doUndoOptsAction(){var a={edit:!0};getCurSEID()&&(a.scheduledExecutionId=getCurSEID());jQuery.ajax({type:"POST",url:_genUrl(appLinks.editOptsUndo),data:a,beforeSend:_ajaxSendTokens.curry("reqtoken_undo_opts"),success:function(a,c,d){jQuery("#optionsContent").find("ul").html(a);_showOptControls()}})}
function _doRedoOptsAction(){var a={edit:!0};getCurSEID()&&(a.scheduledExecutionId=getCurSEID());jQuery.ajax({type:"POST",url:_genUrl(appLinks.editOptsRedo),data:a,beforeSend:_ajaxSendTokens.curry("reqtoken_undo_opts"),success:function(a,c,d){jQuery("#optionsContent").find("ul").html(a);_showOptControls()}})}
function _doRevertOptsAction(){var a={edit:!0};getCurSEID()&&(a.scheduledExecutionId=getCurSEID());jQuery.ajax({type:"POST",url:_genUrl(appLinks.editOptsRevert),data:a,beforeSend:_ajaxSendTokens.curry("reqtoken_undo_opts"),success:function(a,c,d){jQuery("#optionsContent").find("ul").html(a);_showOptControls()}})}var jobNameFieldId,jobGroupFieldId;
function jobChosen(a,b){jobWasEdited();jobNameFieldId&&jobGroupFieldId&&(jQuery("#"+jobNameFieldId).val(a),jQuery("#"+jobGroupFieldId).val(b));hideJobChooser()}
function loadJobChooser(a,b,c,d){jQuery(a).hasClass("active")?hideJobChooser():(jobNameFieldId=c,jobGroupFieldId=d,jQuery(a).button("loading").addClass("active"),jQuery.ajax({url:_genUrl(appLinks.menuJobsPicker,{jobsjscallback:"true",runAuthRequired:!0}),success:function(b,c,d){jQuery(a).popover({html:!0,container:"body",placement:"left",content:b,trigger:"manual"}).popover("show");jQuery(a).button("reset")},error:function(b,c,d){showError("Error performing request: menuJobsPicker: "+transport);jQuery(a).button("reset")}}))}
function hideJobChooser(){jQuery(".btn.act_choose_job").removeClass("active").button("reset").popover("hide")}function groupChosen(a){jobWasEdited();$("schedJobGroup").setValue(a);$("schedJobGroup").highlight();jQuery("#groupChooseBtn").popover("hide")}
function loadGroupChooser(){var a=jQuery("#groupChooseBtn");a.button("loading");jQuery("#schedEditFrameworkProject").val();"true"==a.data("grouptreeshown")?(a.popover("hide"),a.button("reset")):jQuery.get(appLinks.scheduledExecutionGroupTreeFragment+"?jscallback=true",function(a){var c=jQuery("#groupChooseBtn");c.popover({html:!0,container:"body",placement:"left",content:a,trigger:"manual"}).popover("show");c.button("reset")})}
jQuery(window).load(function(){jQuery("#groupChooseBtn").click(loadGroupChooser);jQuery("#groupChooseBtn").on("shown.bs.popover",function(a){jQuery("#groupChooseBtn").data("grouptreeshown","true")});jQuery("#groupChooseBtn").on("hide.bs.popover",function(a){jQuery("#groupChooseBtn").data("grouptreeshown","false")})});