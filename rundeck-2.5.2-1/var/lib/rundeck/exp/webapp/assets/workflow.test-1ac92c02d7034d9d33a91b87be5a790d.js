var RDWorkflow=Class.create({workflow:null,nodeSteppluginDescriptions:null,wfSteppluginDescriptions:null,initialize:function(a,b){this.workflow=a;Object.extend(this,b)},contextType:function(a){a=this.workflow[RDWorkflow.workflowIndexForContextId(a[0])];if("undefined"!=typeof a){if(a.exec)return"command";if(a.jobref)return"job";if(a.script)return"script";if(a.scriptfile)return"scriptfile";if(a.type)return a.nodeStep?"node-step-plugin plugin":null==a.nodeStep||a.nodeStep?"plugin":"workflow-step-plugin plugin"}return"console"},
renderContextStepNumber:function(a){"string"==typeof a&&(a=RDWorkflow.parseContextId(a));a=""+RDWorkflow.stepNumberForContextId(a[0]);return a+". "},renderContextString:function(a){"string"==typeof a&&(a=RDWorkflow.parseContextId(a));var b="";a=this.workflow[RDWorkflow.workflowIndexForContextId(a[0])];if("undefined"!=typeof a)a.description?b=a.description:a.exec?b="Command":a.jobref?b=(a.jobref.group?a.jobref.group+"/":"")+a.jobref.name:a.script?b="Script":a.scriptfile?b=a.scriptfile:a.type&&(b="Plugin "+
a.type,a.nodeStep&&this.nodeSteppluginDescriptions?b=this.nodeSteppluginDescriptions[a.type].title:!a.nodeStep&&this.wfSteppluginDescriptions&&(b=this.wfSteppluginDescriptions[a.type].title));else return"[?]";return b}});RDWorkflow.contextStringSeparator="/";RDWorkflow.parseContextId=function(a){if(null==a)return null;a=a.split(RDWorkflow.contextStringSeparator);for(var b=0,c=[],b=0;b<a.length;b++)c.push(a[b]);return c};
RDWorkflow.paramsForContextId=function(a){a=a.match(/^(\d+)(e)?(@(.+))?$/);return a[4]?a[4]:null};RDWorkflow.isErrorhandlerForContextId=function(a){return"e"==a.match(/^(\d+)(e)?(@.+)?$/)[2]?!0:!1};RDWorkflow.stepNumberForContextId=function(a){a=a.match(/^(\d+)(e)?(@.+)?$/);return a[1]?parseInt(a[1]):null};RDWorkflow.workflowIndexForContextId=function(a){a=RDWorkflow.stepNumberForContextId(a);return null!=a?a-1:null};
RDWorkflow.cleanContextId=function(a){a=RDWorkflow.parseContextId(a);for(var b=0;b<a.length;b++)a[b]=RDWorkflow.stepNumberForContextId(a[b]);return a.join(RDWorkflow.contextStringSeparator)};
RDWorkflow.test=function(){console.assert("node=a"===RDWorkflow.paramsForContextId("2@node=a"));console.assert(2===RDWorkflow.stepNumberForContextId("2@node=a"));console.assert(1===RDWorkflow.workflowIndexForContextId("2@node=a"));console.assert(!1===RDWorkflow.isErrorhandlerForContextId("2@node=a"));console.assert(null===RDWorkflow.paramsForContextId("2"));console.assert(2===RDWorkflow.stepNumberForContextId("2"));console.assert(1===RDWorkflow.workflowIndexForContextId("2"));console.assert(!1===
RDWorkflow.isErrorhandlerForContextId("2"));console.assert(null===RDWorkflow.paramsForContextId("2e"));console.assert(2===RDWorkflow.stepNumberForContextId("2e"));console.assert(1===RDWorkflow.workflowIndexForContextId("2e"));console.assert(!0===RDWorkflow.isErrorhandlerForContextId("2e"));console.assert("blah=c"===RDWorkflow.paramsForContextId("2e@blah=c"));console.assert(2===RDWorkflow.stepNumberForContextId("2e@blah=c"));console.assert(1===RDWorkflow.workflowIndexForContextId("2e@blah=c"));console.assert(!0===
RDWorkflow.isErrorhandlerForContextId("2e@blah=c"));console.assert(1===RDWorkflow.stepNumberForContextId("1e@blah=c"));console.assert(0===RDWorkflow.workflowIndexForContextId("1e@blah=c"));console.assert(!0===RDWorkflow.isErrorhandlerForContextId("1e@blah=c"));console.assert(1===RDWorkflow.parseContextId("1").length,"wrong length");console.assert(2===RDWorkflow.parseContextId("1/1").length,"wrong length");console.assert(3===RDWorkflow.parseContextId("1/1/1").length,"wrong length");console.assert("1"===
RDWorkflow.parseContextId("1/2/3")[0],"wrong value");console.assert("2"===RDWorkflow.parseContextId("1/2/3")[1],"wrong value");console.assert("3"===RDWorkflow.parseContextId("1/2/3")[2],"wrong value");console.assert("1e@abc"===RDWorkflow.parseContextId("1e@abc/2/3")[0],"wrong value");console.assert("2e@asdf=xyz"===RDWorkflow.parseContextId("1/2e@asdf=xyz/3")[1],"wrong value");console.assert("1/2/3"===RDWorkflow.cleanContextId("1/2/3"),"wrong value");console.assert("1/2/3"===RDWorkflow.cleanContextId("1e@abc/2/3"),
"wrong value");console.assert("1/2/3"===RDWorkflow.cleanContextId("1/2e@asdf=xyz/3"),"wrong value")};jQuery(function(){RDWorkflow.test()});